<!DOCTYPE html>
<html>
<head>
    <title>超商霜淇淋地圖</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" crossorigin=""/>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon.png">

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>

    <style>
        /* 基礎樣式與響應式 */
        html, body, #map {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 600px; 
        }
        
        /* 手機最佳化：強制佔滿整個視窗高度 */
        @media (max-width: 768px) {
            html, body {
                height: 100vh;
            }
            #map {
                height: 100vh; 
            }
        }
        
        /* 設置自訂定位按鈕圖標和外觀 */
        .leaflet-control-locate a {
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32"><path fill="%23333" d="M16 4c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm0 2c5.523 0 10 4.477 10 10s-4.477 10-10 10-10-4.477-10-10 4.477-10 10-10zm0 3c-3.866 0-7 3.134-7 7s3.134 7 7 7 7-3.134 7-7-3.134-7-7-7zm0 2c2.761 0 5 2.239 5 5s-2.239 5-5 5-5-2.239-5-5 2.239-5 5-5z"/></svg>');
            background-size: 26px 26px;
            background-position: 50% 50%;
            background-repeat: no-repeat;
            display: block;
            width: 30px;
            height: 30px;
            border-radius: 4px;
        }

        /* 自訂圓形標記基礎樣式 (L.DivIcon) */
        .circle-icon {
            box-sizing: border-box; 
            text-align: center;
            line-height: 20px; 
            font-size: 12px;
            font-weight: bold;
            color: #000000; 
            border: 3px solid #000000; 
            border-radius: 50%; 
            width: 26px; 
            height: 26px; 
            opacity: 1;
        }

        /* 7-11 (雪淋霜) - 鮮豔橘紅 (亮) */
        .xuelin-icon {
            background-color: #FF4500; 
            color: #FFFFFF;
        }

        /* 7-11 (雙口味) - 中等橘色 */
        .double-flavour-711-icon {
            background-color: #FF8C00; 
        }
        
        /* 7-11 (酷聖霜) - 深紅棕橘色 (深) */
        .kusheng-icon {
            background-color: #A0522D; 
            color: #FFFFFF;
        }

        /* 全家單口味樣式 (標準藍) */
        .family-single-icon {
            background-color: #00A9E0; 
            color: #FFFFFF;
        }

        /* 全家雙口味樣式 (青色/淺藍綠) */
        .family-double-icon {
            background-color: #40E0D0; 
        }
    </style>
</head>
<body>

    <div id="map"></div>

    <script>
        // =================================================================
        // 🌟 最新 7-11 門市清單 (已按區域分隔) 🌟
        // 全家門市清單暫時為空，但圖層已恢復
        // =================================================================
        const STORE_DATA = [
            // --- 基隆市 ---
            // (雪淋霜)
            [25.151645, 121.771167, '海洋', '7-11(雪淋霜)', '基隆市中正區中正路609號', '雪'],
            [25.084282, 121.691632, '篤勝', '7-11(雪淋霜)', '基隆市七堵區大德路103號', '雪'],
            [25.092587, 121.736501, '暖鑫', '7-11(雪淋霜)', '基隆市暖暖區暖暖街554號', '雪'],
            [25.099333, 121.758273, '源遠', '7-11(雪淋霜)', '基隆市暖暖區源遠路294號', '雪'],
            [25.154544, 121.696496, '瑞金', '7-11(雪淋霜)', '基隆市安樂區基金三路75號', '雪'],
            [25.126628, 121.715708, '樂三', '7-11(雪淋霜)', '基隆市安樂區樂利三街257號', '雪'],
            [25.149692, 121.727296, '德欣', '7-11(雪淋霜)', '基隆市中山區復興路328號之6', '雪'],
            [25.132265, 121.739457, '基隆南站', '7-11(雪淋霜)', '基隆市仁愛區港西街5號', '雪'],
            [25.129408, 121.743795, '新廟口', '7-11(雪淋霜)', '基隆市仁愛區仁二路228號', '雪'],
            [25.128893, 121.757222, '基信', '7-11(雪淋霜)', '基隆市信義區信二路23號', '雪'],
            [25.136721, 121.778876, '深美', '7-11(雪淋霜)', '基隆市信義區深美街196號', '雪'],
            [25.126494, 121.784859, '滿福', '7-11(雪淋霜)', '基隆市信義區深澳坑路166之30號', '雪'],
            // (酷聖霜)
            [25.150839, 121.772593, '海大夢泉', '7-11(酷聖霜)', '基隆市中正區北寧路2號', '酷'],
            [25.09817, 121.748957, '碇內', '7-11(酷聖霜)', '基隆市暖暖區源遠路158號', '酷'],
            [25.128793, 121.742656, '極上', '7-11(酷聖霜)', '基隆市仁愛區仁三路66號', '酷'],

            // --- 新北市 板橋區 ---
            // (雪淋霜)
            [25.022531, 121.454378, '中一', '7-11(雪淋霜)', '新北市板橋區中正路332之5號', '雪'],
            [25.005889, 121.447569, '台藝大', '7-11(雪淋霜)', '新北市板橋區大觀路一段59號', '雪'],
            [25.028362, 121.461074, '吉翠', '7-11(雪淋霜)', '新北市板橋區裕民街53號', '雪'],
            [24.9935, 121.433242, '成合', '7-11(雪淋霜)', '新北市板橋區金門街40號', '雪'],
            [25.009657, 121.456416, '府中', '7-11(雪淋霜)', '新北市板橋區府中路82號', '雪'],
            [25.00784, 121.460905, '府運', '7-11(雪淋霜)', '新北市板橋區重慶路18號', '雪'],
            [25.026406, 121.458132, '杰朋', '7-11(雪淋霜)', '新北市板橋區新海路385巷10弄11號', '雪'],
            [25.019033, 121.466632, '板依', '7-11(雪淋霜)', '新北市板橋區文化路一段188巷38號', '雪'],
            [24.997056, 121.445759, '板橋樂群', '7-11(雪淋霜)', '新北市板橋區樂群路152號', '雪'],
            [25.024802, 121.468362, '武江', '7-11(雪淋霜)', '新北市板橋區光武街2巷2號', '雪'],
            [25.016679, 121.47516, '家豐', '7-11(雪淋霜)', '新北市板橋區中山路二段137號', '雪'],
            [25.021961, 121.467159, '埔西', '7-11(雪淋霜)', '新北市板橋區文化路一段393號', '雪'],
            [25.024363, 121.461035, '英海', '7-11(雪淋霜)', '新北市板橋區雨農路50號', '雪'],
            [25.020572, 121.465897, '致理', '7-11(雪淋霜)', '新北市板橋區陽明街23巷29號', '雪'],
            [24.984759, 121.428291, '金福', '7-11(雪淋霜)', '新北市板橋區金門街330號', '雪'],
            [25.032765, 121.466262, '華富', '7-11(雪淋霜)', '新北市板橋區華江一路501號', '雪'],
            [25.006174, 121.45437, '雅東', '7-11(雪淋霜)', '新北市板橋區南雅東路31之1號', '雪'],
            [25.011949, 121.469691, '雅盛', '7-11(雪淋霜)', '新北市板橋區漢生東路181號', '雪'],
            [25.012359, 121.445747, '新僑中', '7-11(雪淋霜)', '新北市板橋區僑中一街124巷3弄3號', '雪'],
            [24.99321, 121.430162, '溪崑', '7-11(雪淋霜)', '新北市板橋區大觀路三段212巷70號', '雪'],
            [25.027631, 121.478928, '瑞林', '7-11(雪淋霜)', '新北市板橋區龍翠里大同街52號', '雪'],
            [25.028717, 121.463204, '維禮', '7-11(雪淋霜)', '新北市板橋區四維路276號', '雪'],
            [24.99704, 121.452028, '遠揚', '7-11(雪淋霜)', '新北市板橋區南雅南路二段124號', '雪'],
            [25.002673, 121.448469, '興觀', '7-11(雪淋霜)', '新北市板橋區大觀路二段37巷34號', '雪'],
            [25.029084, 121.473754, '龍翠', '7-11(雪淋霜)', '新北市板橋區雙十路二段138之1號', '雪'],
            [25.032684, 121.477309, '懷德', '7-11(雪淋霜)', '新北市板橋區懷德街55號', '雪'],

            // --- 新北市 汐止區 ---
            // (雪淋霜)
            [25.071043, 121.679436, '旭昇', '7-11(雪淋霜)', '新北市汐止區大同路三段332號', '雪'],
            [25.072951, 121.651791, '汐政', '7-11(雪淋霜)', '新北市汐止區汐萬路一段222號', '雪'],
            [25.069924, 121.628607, '明峰', '7-11(雪淋霜)', '新北市汐止區明峰街179之1號', '雪'],
            [25.064896, 121.629906, '德厚', '7-11(雪淋霜)', '新北市汐止區福德二路189號', '雪'],
            [25.068874, 121.631242, '鑫東冠', '7-11(雪淋霜)', '新北市汐止區康寧街459巷3號', '雪'],
            // (酷聖霜)
            [25.067965, 121.621221, '汐湖', '7-11(酷聖霜)', '新北市汐止區康寧街141巷49號', '酷'],
            [25.069597, 121.632137, '湖鑫', '7-11(酷聖霜)', '新北市汐止區湖前街37號', '酷'],

            // --- 台北市 松山區 ---
            // (雪淋霜)
            [25.048072, 121.551219, '台場', '7-11(雪淋霜)', '台北市松山區八德路三段20-2號', '雪'],
            [25.046036, 121.553695, '吉仁', '7-11(雪淋霜)', '台北市松山區延吉街27-1號', '雪'],
            [25.049599, 121.559552, '京復', '7-11(雪淋霜)', '台北市松山區光復北路11巷44號', '雪'],
            [25.051691, 121.561591, '京發', '7-11(雪淋霜)', '台北市松山區南京東路五段139之4號', '雪'],
            [25.052053, 121.558079, '東光', '7-11(雪淋霜)', '台北市松山區南京東路五段23巷4號', '雪'],
            [25.059059, 121.546266, '東復', '7-11(雪淋霜)', '台北市松山區復興北路313巷25號', '雪'],
            [25.058357, 121.550369, '東鑫', '7-11(雪淋霜)', '台北市松山區民生東路四段55巷10號', '雪'],
            [25.052387, 121.563978, '松民', '7-11(雪淋霜)', '台北市松山區三民路10號', '雪'],
            [25.050692, 121.571616, '松禾', '7-11(雪淋霜)', '台北市松山區塔悠路31號33號', '雪'],
            [25.052761, 121.544632, '松慶', '7-11(雪淋霜)', '台北市松山區慶城街1號', '雪'],
            [25.048705, 121.544262, '復星', '7-11(雪淋霜)', '台北市松山區復興北路15-6號', '雪'],
            [25.059812, 121.5681, '塔優', '7-11(雪淋霜)', '台北市松山區撫遠街197號', '雪'],
            [25.047939, 121.556424, '新復勢', '7-11(雪淋霜)', '台北市松山區八德路三段200號', '雪'],
            // (酷聖霜)
            [25.051203, 121.577973, '松饒', '7-11(酷聖霜)', '台北市松山區慈祐里八德路四段767號', '酷'],
            [25.054041, 121.549352, '敦北', '7-11(酷聖霜)', '台北市松山區敦化北路149號', '酷'],

            // --- 台北市 信義區 ---
            // (雪淋霜)
            [25.042221, 121.562903, '巨東', '7-11(雪淋霜)', '台北市信義區忠孝東路四段553巷6弄2號', '雪'],
            [25.028025, 121.556749, '昌隆', '7-11(雪淋霜)', '台北市信義區基隆路二段131-4號', '雪'],
            [25.049196, 121.578307, '松茂', '7-11(雪淋霜)', '台北市信義區松山路11號地下1樓', '雪'],
            [25.042983, 121.565843, '松高', '7-11(雪淋霜)', '台北市信義區基隆路一段141號', '雪'],
            [25.038746, 121.585879, '留公', '7-11(雪淋霜)', '台北市信義區福德街247號', '雪'],
            [25.047457, 121.56664, '道生', '7-11(雪淋霜)', '台北市信義區新仁里東興路57號', '雪'],
            [25.039515, 121.565242, '夢廣場', '7-11(雪淋霜)', '台北市信義區松高路11號地下2樓', '雪'],
            [25.039497, 121.57669, '慶林', '7-11(雪淋霜)', '台北市信義區虎林街151號', '雪'],
            [25.04186, 121.5637, '聯合', '7-11(雪淋霜)', '台北市信義區忠孝東路四段559巷6號', '雪'],
            // (雙口味)
            [25.026837, 121.568511, '松仁', '7-11(雙口味)', '台北市信義區松仁路213號', '雙'],

            // --- 台北市 大安區 ---
            // (雪淋霜)
            [25.017603, 121.53258, '大台', '7-11(雪淋霜)', '台北市大安區羅斯福路三段333巷18號', '雪'],
            [25.037071, 121.543887, '大安復興', '7-11(雪淋霜)', '台北市大安區復興南路一段247號', '雪'],
            [25.013743, 121.540623, '台科一', '7-11(雪淋霜)', '台北市大安區基隆路四段43號', '雪'],
            [25.030408, 121.529585, '永康', '7-11(雪淋霜)', '台北市大安區永康街43號', '雪'],
            [25.026602, 121.546909, '合億', '7-11(雪淋霜)', '台北市大安區和平東路三段1巷51號', '雪'],
            [25.024491, 121.547636, '和鑫', '7-11(雪淋霜)', '台北市大安區和平東路三段38號', '雪'],
            [25.017413, 121.544946, '長星', '7-11(雪淋霜)', '台北市大安區基隆路三段85號', '雪'],
            [25.0337, 121.538691, '信中', '7-11(雪淋霜)', '台北市大安區信義路三段99號', '雪'],
            [25.040085, 121.551972, '建綸', '7-11(雪淋霜)', '台北市大安區仁愛路四段151巷33號', '雪'],
            [25.02569, 121.543891, '科興', '7-11(雪淋霜)', '台北市大安區復興南路二段271巷2號', '雪'],
            [25.039954, 121.5532, '統家', '7-11(雪淋霜)', '台北市大安區忠孝東路四段216巷27弄1號', '雪'],
            [25.03225, 121.557291, '復昌', '7-11(雪淋霜)', '台北市大安區通化里光復南路616號', '雪'],
            [25.027452, 121.553582, '華電', '7-11(雪淋霜)', '台北市大安區通化街177號', '雪'],
            [25.036916, 121.549712, '圓金', '7-11(雪淋霜)', '台北市大安區仁愛路四段112巷7號', '雪'],
            [25.040109, 121.533889, '濟南', '7-11(雪淋霜)', '台北市大安區濟南路三段12號', '雪'],

            // --- 台北市 中山區 ---
            // (雪淋霜)
            [25.060397, 121.522116, '永錦', '7-11(雪淋霜)', '台北市中山區錦西街1號', '雪'],
            [25.05284, 121.531651, '江陵', '7-11(雪淋霜)', '台北市中山區一江街23號', '雪'],
            [25.058115, 121.535932, '佳佳', '7-11(雪淋霜)', '台北市中山區民生東路二段157號', '雪'],
            [25.057932, 121.524604, '林北', '7-11(雪淋霜)', '台北市中山區民生東路一段46號', '雪'],
            [25.058197, 121.525124, '林森北', '7-11(雪淋霜)', '台北市中山區民生東路一段29號', '雪'],
            [25.063037, 121.519885, '金蓬', '7-11(雪淋霜)', '台北市中山區民權西路73號', '雪'],
            [25.055064, 121.523666, '長北', '7-11(雪淋霜)', '台北市中山區長春路11號', '雪'],
            [25.056435, 121.522554, '長城', '7-11(雪淋霜)', '台北市中山區中山北路二段56號', '雪'],
            [25.05167, 121.543246, '威克', '7-11(雪淋霜)', '台北市中山區南京東路三段208號', '雪'],
            [25.059954, 121.53733, '建錦', '7-11(雪淋霜)', '台北市中山區建國北路二段127號', '雪'],
            [25.053471, 121.54386, '復北', '7-11(雪淋霜)', '台北市中山區復興北路164號', '雪'],
            [25.054625, 121.525327, '晶華', '7-11(雪淋霜)', '台北市中山區林森北路262號', '雪'],
            [25.050153, 121.524974, '森鑽', '7-11(雪淋霜)', '台北市中山區林森北路101號', '雪'],
            [25.082833, 121.546484, '新大直', '7-11(雪淋霜)', '台北市中山區北安路621巷48號', '雪'],
            [25.051632, 121.536405, '新寶', '7-11(雪淋霜)', '台北市中山區建國北路一段156號', '雪'],
            [25.08031, 121.558379, '萬濠', '7-11(雪淋霜)', '台北市中山區敬業四路1號', '雪'],
            [25.065014, 121.528028, '稻江', '7-11(雪淋霜)', '台北市中山區新生北路三段35號', '雪'],
            [25.060348, 121.539317, '錦合', '7-11(雪淋霜)', '台北市中山區合江街117號', '雪'],
            [25.052745, 121.540355, '龍京', '7-11(雪淋霜)', '台北市中山區龍江路104號', '雪'],
            [25.049116, 121.526589, '鑫長安', '7-11(雪淋霜)', '台北市中山區長安東路一段53巷1之3號', '雪'],

            // --- 台北市 中正區 ---
            // (酷聖霜)
            [25.026039, 121.508185, '掬華', '7-11(酷聖霜)', '台北市中正區中華路二段405號', '酷'],
            [25.014308, 121.530574, '博源', '7-11(酷聖霜)', '台北市中正區思源街16號', '酷'],

            // --- 台北市 大同區 ---
            // (雪淋霜)
            [25.057604, 121.519262, '仟發', '7-11(雪淋霜)', '台北市大同區民生西路95號', '雪'],
            [25.068708, 121.516183, '民族西', '7-11(雪淋霜)', '台北市大同區民族西路151號', '雪'],
            [25.068525, 121.51248, '延民', '7-11(雪淋霜)', '台北市大同區民族西路246號', '雪'],
            [25.071449, 121.513585, '酒泉', '7-11(雪淋霜)', '台北市大同區重慶北路三段258號', '雪'],
            [25.056902, 121.51499, '鑫寧', '7-11(雪淋霜)', '台北市大同區民生西路214號', '雪'],

            // --- 台北市 萬華區 ---
            // (雪淋霜)
            [25.042786, 121.504857, '世運', '7-11(雪淋霜)', '台北市萬華區昆明街81號', '雪'],
            [25.047177, 121.505937, '昆福', '7-11(雪淋霜)', '台北市萬華區昆明街30-1號', '雪'],
            [25.038829, 121.500692, '欣昌', '7-11(雪淋霜)', '台北市萬華區西昌街177號', '雪'],
            [25.029677, 121.503412, '華藏', '7-11(雪淋霜)', '台北市萬華區西藏路107號', '雪'],
            [25.023551, 121.492749, '園寶', '7-11(雪淋霜)', '台北市萬華區西園路二段281巷29號', '雪'],
            [25.029544, 121.494437, '園鑫', '7-11(雪淋霜)', '台北市萬華區雙園街28號', '雪'],
            [25.041167, 121.506823, '漢中', '7-11(雪淋霜)', '台北市萬華區漢中街185號', '雪'],

            // --- 台北市 文山區 ---
            // (雪淋霜)
            [24.984513, 121.562365, '文忠', '7-11(雪淋霜)', '台北市文山區忠順街二段10號', '雪'],
            [24.983131, 121.55938, '忠順', '7-11(雪淋霜)', '台北市文山區忠順街一段26巷22號', '雪'],
            [24.990311, 121.540974, '景中', '7-11(雪淋霜)', '台北市文山區景文里景文街96號', '雪'],
            [25.002161, 121.537333, '隆合', '7-11(雪淋霜)', '台北市文山區羅斯福路五段218巷28號', '雪'],
            [24.988616, 121.559924, '新安康', '7-11(雪淋霜)', '台北市文山區木柵路二段88號90號', '雪'],
            // (酷聖霜)
            [24.987293, 121.548008, '世成', '7-11(酷聖霜)', '台北市文山區木柵路一段111號1樓(世新大管院)', '酷'],

            // --- 台北市 南港區 ---
            // (雪淋霜)
            [25.057136, 121.60083, '慈愛', '7-11(雪淋霜)', '台北市南港區重陽路164號', '雪'],
            // (雙口味)
            [25.059345, 121.617583, '三井', '7-11(雙口味)', '台北市南港區經貿二路131號(B1-01300櫃位)', '雙'],

            // --- 台北市 內湖區 ---
            // (雪淋霜)
            [25.064549, 121.583185, '全球', '7-11(雪淋霜)', '台北市內湖區新湖二路329號', '雪'],
            [25.074871, 121.577067, '見晴', '7-11(雪淋霜)', '台北市內湖區瑞光路196號', '雪'],
            [25.067198, 121.615888, '東湖', '7-11(雪淋霜)', '台北市內湖區五分街62號', '雪'],
            [25.088376, 121.586973, '金碧', '7-11(雪淋霜)', '台北市內湖區金龍路219號', '雪'],
            [25.067739, 121.612382, '悅來', '7-11(雪淋霜)', '台北市內湖區五分街9號', '雪'],
            [25.073361, 121.618495, '泰樂', '7-11(雪淋霜)', '台北市內湖區安泰街26號', '雪'],
            [25.054881, 121.581053, '新潭美', '7-11(雪淋霜)', '台北市內湖區新明路425號', '雪'],
            [25.078814, 121.573212, '德馨', '7-11(雪淋霜)', '台北市內湖區洲子街46號', '雪'],
            [25.083075, 121.565389, '環武', '7-11(雪淋霜)', '台北市內湖區環山路一段8號', '雪'],
            [25.077407, 121.575081, '鴻瑞', '7-11(雪淋霜)', '台北市內湖區瑞光路335號', '雪'],
            [25.068196, 121.592648, '寶湖', '7-11(雪淋霜)', '台北市內湖區民權東路六段180巷6號', '雪'],

            // --- 台北市 士林區 ---
            // (雪淋霜)
            [25.11797, 121.535853, '三玉', '7-11(雪淋霜)', '台北市士林區天母東路88之1號', '雪'],
            [25.116447, 121.531633, '天福', '7-11(雪淋霜)', '台北市士林區天福里天母東路8巷39號', '雪'],
            [25.137889, 121.546263, '文大', '7-11(雪淋霜)', '台北市士林區格致路57號', '雪'],
            [25.088761, 121.522552, '承河', '7-11(雪淋霜)', '台北市士林區基河路132號', '雪'],
            [25.081161, 121.520405, '通河', '7-11(雪淋霜)', '台北市士林區通河街151號', '雪'],
            [25.136963, 121.541507, '華岡', '7-11(雪淋霜)', '台北市士林區光華路26巷7-1號', '雪'],
            [25.10395, 121.526724, '新忠誠', '7-11(雪淋霜)', '台北市士林區中山北路六段18號', '雪'],
            [25.084275, 121.517471, '新劍潭', '7-11(雪淋霜)', '台北市士林區福港街246號', '雪'],
            [25.085267, 121.509576, '福陽', '7-11(雪淋霜)', '台北市士林區延平北路五段269號', '雪'],
            [25.104108, 121.521234, '福溢', '7-11(雪淋霜)', '台北市士林區德行西路96號', '雪'],
            [25.09552, 121.526079, '福榮', '7-11(雪淋霜)', '台北市士林區中正路220號', '雪'],
            [25.112358, 121.537533, '德芝', '7-11(雪淋霜)', '台北市士林區士東路266巷5弄18號', '雪'],
            [25.107631, 121.528604, '德誠', '7-11(雪淋霜)', '台北市士林區德行東路106號', '雪'],
            [25.094757, 121.518465, '豐基', '7-11(雪淋霜)', '台北市士林區基河路368號', '雪'],

            // --- 台北市 北投區 ---
            // (雪淋霜)
            [25.12509, 121.500496, '北投奇岩', '7-11(雪淋霜)', '台北市北投區中央南路二段31號', '雪'],
            [25.118701, 121.516234, '立陽', '7-11(雪淋霜)', '台北市北投區立農街二段299號', '雪'],
            [25.117477, 121.512927, '安遠', '7-11(雪淋霜)', '台北市北投區致遠二路149號', '雪'],
            [25.145284, 121.495171, '秀山', '7-11(雪淋霜)', '台北市北投區中和街476號', '雪'],
            [25.126307, 121.507946, '岩投', '7-11(雪淋霜)', '台北市北投區公館路230號', '雪'],
            [25.136457, 121.496028, '政戰', '7-11(雪淋霜)', '台北市北投區中央北路二段15號', '雪'],
            [25.110551, 121.514608, '統勝', '7-11(雪淋霜)', '台北市北投區自強街82號', '雪'],
            [25.152532, 121.547462, '擎天崗', '7-11(雪淋霜)', '台北市北投區湖山路一段12號', '雪'],
            [25.117398, 121.506908, '鐏賢', '7-11(雪淋霜)', '台北市北投區尊賢街247號', '雪'],
            // (酷聖霜)
            [25.135815, 121.5057, '加賀屋', '7-11(酷聖霜)', '台北市北投區溫泉路73巷5號', '酷']
        ];
        
        
        // 輔助函數：創建帶文字的 L.DivIcon 標記 
        function getStoreIcon(layerName, noteText) {
            let className = 'circle-icon ';
            switch (layerName) {
                case '7-11(雪淋霜)':
                    className += 'xuelin-icon'; 
                    break;
                case '7-11(酷聖霜)':
                    className += 'kusheng-icon'; 
                    break;
                case '7-11(雙口味)':
                    className += 'double-flavour-711-icon'; 
                    break;
                case 'FamilyMart(單口味)':
                    className += 'family-single-icon';
                    break;
                case 'FamilyMart(雙口味)':
                    className += 'family-double-icon';
                    break;
                default:
                    className += 'xuelin-icon'; 
            }
            const htmlContent = noteText.trim() || '&nbsp;'; 
            return L.divIcon({
                className: className,
                html: htmlContent,
                iconSize: [26, 26], 
                iconAnchor: [13, 13] 
            });
        }

        // 定義藍色地標圖案 (使用者定位點)
        const blueIcon = new L.Icon({
            iconUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png',
            shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
            iconSize: [25, 41],
            iconAnchor: [12, 41],
            popupAnchor: [1, -34],
            shadowSize: [41, 41]
        });

        const INITIAL_CENTER = [25.06, 121.6]; 
        const INITIAL_ZOOM = 10;
        const DEFAULT_ZOOM = 15; 
        const DEFAULT_LOCATION = [25.047176, 121.517058]; 
        
        let currentLocationMarker;
        let accuracyCircle;

        // 1. 初始化地圖
        const map = L.map('map', {
            center: INITIAL_CENTER, 
            zoom: INITIAL_ZOOM,
            zoomControl: false 
        });
        
        // 放大/縮小控制項移至右下角
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        // 2. 加入 OpenStreetMap 圖層
        const osmLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);


        // 3. 創建圖層群組 
        const sevenElevenXueLinGroup = L.layerGroup();
        const sevenElevenKuShengGroup = L.layerGroup();
        const sevenElevenDoubleGroup = L.layerGroup();
        
        // 恢復全家圖層群組 (目前無打點)
        const familySingleGroup = L.layerGroup(); 
        const familyDoubleGroup = L.layerGroup(); 


        // 4. 動態新增打點 (只處理 7-11 資料)
        STORE_DATA.forEach(data => {
            const [lat, lng, name, layerName, popupContent, noteText] = data;
            const iconToUse = getStoreIcon(layerName, noteText);
            const marker = L.marker([lat, lng], {
                icon: iconToUse
            }).bindPopup(`<b>${name}</b><br>${popupContent}`);

            switch (layerName) {
                case '7-11(雪淋霜)':
                    marker.addTo(sevenElevenXueLinGroup);
                    break;
                case '7-11(酷聖霜)':
                    marker.addTo(sevenElevenKuShengGroup);
                    break;
                case '7-11(雙口味)':
                    marker.addTo(sevenElevenDoubleGroup);
                    break;
                // FamilyMart(單口味) 和 FamilyMart(雙口味) 暫時不處理打點
            }
        });
        
        // 將所有 7-11 圖層預設開啟
        sevenElevenXueLinGroup.addTo(map);
        sevenElevenKuShengGroup.addTo(map);
        sevenElevenDoubleGroup.addTo(map);


        // 5. 加入圖層控制項 (移至左上角)
        const baseLayers = {
            "OpenStreetMap": osmLayer
        };

        const overlayLayers = {
            "🔴 7-11 (雪淋霜)": sevenElevenXueLinGroup, 
            "🟠 7-11 (雙口味)": sevenElevenDoubleGroup, 
            "🟤 7-11 (酷聖霜)": sevenElevenKuShengGroup,
            // 移除了分隔線
            "🔵 全家 (單口味)": familySingleGroup, 
            "🟢 全家 (雙口味)": familyDoubleGroup  
        };
        
        L.control.layers(baseLayers, overlayLayers, {
            collapsed: false, 
            position: 'topleft' 
        }).addTo(map);


        // --- 定位功能實作 (維持不變) ---

        // 成功定位處理
        function onLocationFound(e) {
            const latlng = e.latlng;
            const radius = e.accuracy;
            
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
            }
            if (accuracyCircle) {
                map.removeLayer(accuracyCircle);
            }

            currentLocationMarker = L.marker(latlng, {
                icon: blueIcon,
                title: "當前位置"
            }).addTo(map)
              .bindPopup("您目前的位置，誤差約 " + radius.toFixed(0) + " 公尺").openPopup();

            accuracyCircle = L.circle(latlng, radius, {
                color: 'blue',
                fillColor: '#30f',
                fillOpacity: 0.1,
                weight: 1
            }).addTo(map);

            map.setView(latlng, DEFAULT_ZOOM, {
                animate: true,
                pan: { duration: 0.5 }
            });
            
            setTimeout(() => {
                currentLocationMarker.closePopup();
            }, 3000);
        }

        // 失敗定位處理
        function onLocationError(e) {
            console.error("定位失敗：", e.message);
            
            if (currentLocationMarker) {
                map.removeLayer(currentLocationMarker);
            }
            if (accuracyCircle) {
                map.removeLayer(accuracyCircle);
            }

            const errorMessage = "無法取得您的地理位置。\n錯誤訊息: " + e.message + "\n地圖將定位於預設位置。";

            currentLocationMarker = L.marker(DEFAULT_LOCATION, {
                icon: blueIcon,
                title: "預設位置"
            }).addTo(map)
              .bindPopup("定位失敗，顯示預設位置").openPopup();

            map.setView(DEFAULT_LOCATION, DEFAULT_ZOOM);
            
            setTimeout(() => {
                currentLocationMarker.closePopup();
            }, 3000);
            
            alert(errorMessage); 
        }

        map.on('locationfound', onLocationFound);
        map.on('locationerror', onLocationError);

        // 6. 自訂定位控制按鈕 (移至右下角)
        const LocateControl = L.Control.extend({
            options: {
                position: 'bottomright' 
            },
            onAdd: function (map) {
                const container = L.DomUtil.create('div', 'leaflet-bar leaflet-control leaflet-control-locate');
                const link = L.DomUtil.create('a', '', container);
                link.href = '#';
                link.title = '定位到您的位置';
                link.role = 'button';

                L.DomEvent.on(link, 'click', L.DomEvent.stop)
                          .on(link, 'click', function () {
                              map.locate({setView: true, maxZoom: DEFAULT_ZOOM});
                          });
                return container;
            }
        });
        map.addControl(new LocateControl());

        // 網頁開啟時的初始定位請求
        map.locate({
            setView: false, 
            maxZoom: DEFAULT_ZOOM,   
            watch: false,  
            enableHighAccuracy: true
        });

    </script>

</body>
</html>
